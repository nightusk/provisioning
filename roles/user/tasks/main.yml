---
- name: Group
  ansible.builtin.user:
    name: '{{ ansible_env.USER }}'
    groups: '{{ item }}'
    append: true
  with_items:
    - '{{ group }}'

- name: Lineinfile
  ansible.builtin.lineinfile:
    path: '{{ ansible_env.HOME }}/.profile'
    line: 'export {{ item }}'
    insertbefore: '# BEGIN ANSIBLE MANAGED BLOCK'
  with_items:
    - '{{ env }}'

- name: Blockinfile
  ansible.builtin.blockinfile:
    path: '{{ ansible_env.HOME }}/.{{ item }}'
    create: true
    mode: '0644'
    block: '{{ lookup("vars", item).block }}'
    marker: '{{ lookup("vars", item).marker }}'
  with_items:
    - bash_profile
    - vimrc
    - zshenv
    - profile

- name: Include
  ansible.builtin.include_tasks:
    file: dotfiles.yml
